## 実装計画書 - ASO テキスト生成 API (MVP)

### 1. 概要

PRD で定義された要件に基づき、ASO テキスト生成 API の MVP を開発するための技術的な計画を詳述する。本計画は「MVP 開発ロードマップ (日英対応・単一言語出力)」に沿って、具体的なタスクレベルまで落とし込む。

### 2. 技術スタック

- **バックエンド:** Python 3.11+, FastAPI
- **データ処理:** Pandas
- **LLM:** Google Generative AI (Gemini) via `google-generativeai` library
- **Web サーバー:** Uvicorn
- **依存関係管理:** pip, `requirements.txt`
- **開発環境:** Docker (推奨)

### 3. API エンドポイント設計

- **エンドポイント:** `POST /api/v1/generate-aso-texts`
- **リクエスト (Pydantic モデル: `ASOTextInput`):**

  ```python
  from fastapi import FastAPI, UploadFile, File, Form
  from pydantic import BaseModel, Field
  from typing import List

  class ASOTextInput(BaseModel):
      app_base_name: str = Field(..., description="アプリの基本名")
      app_features: List[str] = Field(..., description="アプリの主な特徴（箇条書き）")
      language: str = Field(..., description="生成言語 ('ja' or 'en')")
  ```

  _リクエスト形式は `multipart/form-data` とし、`UploadFile` と `Form` を使用して受け取る。_

- **レスポンス (Pydantic モデル: `ASOTextOutput`):**
  ```python
  class ASOTextOutput(BaseModel):
      title: str = Field(..., description="生成されたタイトル (最大30文字)")
      subtitle: str = Field(..., description="生成されたサブタイトル (最大30文字)")
      keywords: str = Field(..., description="生成されたキーワード (最大100文字)")
      description: str = Field(..., description="生成された概要 (最大4000文字)")
      whats_new: str = Field(..., description="生成された最新情報 (最大4000文字)")
  ```

### 4. 実装タスクブレークダウン

#### **フェーズ 1: 基盤構築と統計分析エンジンの実装**

- **タスク 0.1:** `fastapi`, `pandas`等を含む`requirements.txt`を作成。
- **タスク 0.2:** `app/`ディレクトリ以下に`main.py`, `services/`, `models/`等の基本構造を作成。
- **タスク 0.3:** `.env`ファイルと設定読み込み用の`config.py`を準備。
- **タスク 1.1:** `models/`に CSV のカラムに対応する Pydantic モデルを作成。
- **タスク 1.2:** `services/statistical_analyzer.py`を作成。
- **タスク 1.3 (コアロジック):** `statistical_analyzer.py`内に、Pandas DataFrame を受け取り、キーワードスコアを計算し、最もスコアの高い「主要キーワード」を返す関数を実装する。

#### **フェーズ 2: テキスト生成機能と Gemini 連携の実装**

- **タスク 2.1:** `statistical_analyzer.py`内に、スコア上位のキーワードから 100 文字のキーワードフィールドを生成する関数を実装。
- **タスク 2.2:** ルールベースでタイトルと「最新情報」の定型文を生成する関数を実装（日英のテンプレート切り替えも含む）。
- **タスク 3.1:** `services/prompts/`ディレクトリと`ja.py`, `en.py`を作成し、サブタイトル用と概要用のプロンプトテンプレートを定義。
- **タスク 3.2:** `services/gemini_generator.py`を作成。`language`パラメータを受け取り、適切なプロンプトを選択して Gemini API を呼び出すクラスを実装。
- **タスク 3.3 (コアロジック):** `gemini_generator.py`内に、サブタイトルと概要を生成するメソッドを実装。文字数制限やキーワード使用の制約をプロンプトに含める。

#### **フェーズ 3: API エンドポイントの統合とテスト**

- **タスク 4.1:** `app/main.py`に`POST /api/v1/generate-aso-texts`エンドポイントを定義。
- **タスク 4.2 (コアロジック):** エンドポイント内で、リクエストを受け取り、フェーズ 1 と 2 で作成したサービスを順次呼び出す処理フローを実装する。`language`パラメータを各サービスに適切に引き渡す。
- **タスク 4.3:** 正常なレスポンスと、CSV フォーマットエラー等の異常系レスポンスを返すことを確認する。
- **タスク 4.4:** `pytest`を導入し、`statistical_analyzer`のスコアリングロジックなど、コアな部分のユニットテストを作成。
- **タスク 4.5:** FastAPI の TestClient を使い、API エンドポイントの統合テストを作成。

### 5. デプロイ計画

- **Docker 化:** アプリケーションをコンテナ化するための`Dockerfile`を作成。
- **デプロイ先:** MVP 段階では Google Cloud Run, AWS App Runner, Vercel などのサーバーレスプラットフォームへのデプロイを推奨。これによりインフラ管理のコストを最小限に抑える。

### 6. タイムライン（概算）

- **フェーズ 1:** 3 営業日
- **フェーズ 2:** 5 営業日
- **フェーズ 3:** 4 営業日
- **合計:** 約 2.5 週間
