### チケット: P3-002 多言語プロンプト管理

#### 背景 / 目的

- **背景**: 既存のプロンプトファイル（`ja.py`, `en.py`）は基本的な構造のみで、Gemini連携用のサブタイトル・概要生成プロンプトが不足している
- **目的**: 日本語・英語の両言語に対応した、Gemini API用のプロンプトテンプレートを完全実装し、言語別の最適化されたプロンプト管理システムを構築する

#### スコープ（このチケットでやること）

1. **サブタイトル生成プロンプトの実装**
   - 日本語版：主要キーワードを含めずにアプリの価値を表現
   - 英語版：同様の制約で英語最適化
   - 30文字制限の明示的な指示

2. **概要生成プロンプトの実装**
   - 日本語版：主要キーワードを4〜7回程度自然に含める
   - 英語版：同様の制約で英語最適化
   - 4000文字制限の明示的な指示

3. **プロンプトテンプレート管理システム**
   - 言語別プロンプトの統一的な管理
   - プロンプトパラメータの動的置換機能
   - プロンプトバージョン管理

4. **プロンプト最適化**
   - 言語特性に応じたプロンプト調整
   - 生成品質向上のためのプロンプトエンジニアリング
   - A/Bテスト用のプロンプトバリエーション

#### やらないこと（Out of Scope）

- Gemini API連携の実装（P3-001で対応）
- サブタイトル・概要生成の具体的なロジック（P3-003, P3-004で対応）
- プロンプトの自動生成機能
- 機械学習によるプロンプト最適化

#### 受入条件（Acceptance Criteria）

- 日本語・英語の両方でサブタイトル生成プロンプトが定義されていること
- 日本語・英語の両方で概要生成プロンプトが定義されていること
- プロンプトが適切な制約（文字数、キーワード制約）を含んでいること
- プロンプトテンプレートが動的パラメータ置換に対応していること
- プロンプトの品質が高く、一貫性があること
- 単体テストが実装され、プロンプトの妥当性が検証されていること

#### 技術仕様

**プロンプト構造:**
```python
class JapanesePrompts:
    SUBTITLE_GENERATION = """
    [サブタイトル生成用プロンプト]
    - 主要キーワードを含めない
    - 30文字以内
    - アプリの価値を表現
    """
    
    DESCRIPTION_GENERATION = """
    [概要生成用プロンプト]
    - 主要キーワードを4〜7回自然に含める
    - 4000文字以内
    - アプリの特徴を説明
    """

class EnglishPrompts:
    SUBTITLE_GENERATION = """
    [English subtitle generation prompt]
    - Exclude main keywords
    - Within 30 characters
    - Express app value
    """
    
    DESCRIPTION_GENERATION = """
    [English description generation prompt]
    - Include main keywords 4-7 times naturally
    - Within 4000 characters
    - Explain app features
    """
```

**プロンプトパラメータ:**
- `{app_name}`: アプリ名
- `{app_features}`: アプリの特徴リスト
- `{main_keyword}`: 主要キーワード
- `{related_keywords}`: 関連キーワード
- `{target_audience}`: ターゲットユーザー

#### 影響/変更ファイル

- 変更:
  - `app/services/prompts/ja.py` (サブタイトル・概要生成プロンプト追加)
  - `app/services/prompts/en.py` (サブタイトル・概要生成プロンプト追加)
- 追加:
  - `app/services/prompts/__init__.py` (プロンプト管理ユーティリティ)
  - `tests/test_prompts.py` (プロンプトテスト)

#### 依存関係 / ブロッカー

- **依存**: P3-001（Gemini サービスクラスの実装）の完了
- **後続**: P3-003（サブタイトル生成）、P3-004（概要生成）は本チケットの完了に依存

#### 実装手順

1. **プロンプト設計**
   - サブタイトル生成プロンプトの設計
   - 概要生成プロンプトの設計
   - 言語特性を考慮した最適化

2. **日本語プロンプト実装**
   - `ja.py`にサブタイトル生成プロンプト追加
   - `ja.py`に概要生成プロンプト追加
   - 日本語特有の表現を考慮

3. **英語プロンプト実装**
   - `en.py`にサブタイトル生成プロンプト追加
   - `en.py`に概要生成プロンプト追加
   - 英語特有の表現を考慮

4. **プロンプト管理システム実装**
   - `__init__.py`にプロンプト管理ユーティリティ追加
   - 動的パラメータ置換機能
   - 言語選択機能

5. **プロンプト最適化**
   - 生成品質向上のための調整
   - 制約の明確化
   - 一貫性の確保

6. **テスト実装**
   - プロンプトの妥当性テスト
   - パラメータ置換テスト
   - 言語別テスト

#### プロンプト設計ガイドライン

**サブタイトル生成プロンプト:**
- 主要キーワードを含めない明確な指示
- 30文字制限の強調
- アプリの価値提案に焦点
- 魅力的で覚えやすい表現の要求

**概要生成プロンプト:**
- 主要キーワードの自然な組み込み指示
- 4000文字制限の明確化
- アプリの特徴説明の構造化
- ユーザーベネフィットの強調

#### 参考資料

- [Gemini Pro プロンプトエンジニアリングガイド](https://ai.google.dev/docs/prompt_engineering)
- [App Store 最適化ガイドライン](https://developer.apple.com/app-store/optimization/)
- [Google Play 最適化ガイドライン](https://support.google.com/googleplay/android-developer/answer/9859452)

#### リスク / 留意点

- **言語特性**: 日本語・英語の言語特性の違いを考慮
- **プロンプト品質**: 生成テキストの品質に直結するため慎重な設計
- **制約管理**: 文字数制限とキーワード制約の適切な管理
- **一貫性**: 言語間での一貫性の確保
- **保守性**: プロンプトの更新・改善のしやすさ

#### 見積り

- **2時間**
  - プロンプト設計: 45分
  - 日本語プロンプト実装: 30分
  - 英語プロンプト実装: 30分
  - プロンプト管理システム実装: 15分

#### 完了定義

- [ ] サブタイトル生成プロンプトが日本語・英語で実装されている
- [ ] 概要生成プロンプトが日本語・英語で実装されている
- [ ] プロンプトが適切な制約を含んでいる
- [ ] プロンプト管理システムが実装されている
- [ ] 単体テストが実装されている
- [ ] プロンプトの品質が検証されている
