### チケット: P2-概要 ルールベース＆統計ベースのテキスト生成機能の実装

#### 背景 / 目的

- **背景**: ステップ 1（CSV 分析と主要キーワード選定エンジン）は実装済みだが、選定された主要キーワードを基にしたテキスト生成機能が未実装
- **目的**: 選定された主要キーワードとスコア上位の関連キーワードを基に、ルールベースと統計ベースのアルゴリズムにより、多言語対応の ASO テキスト（キーワードフィールド、タイトル、最新情報）を自動生成する機能を実装する

#### スコープ（このチケットでやること）

ステップ 2 では以下の 3 つのサブタスクを順次実装します：

1. **P2-001: キーワードフィールド (100 文字) 生成**

   - 主要キーワードとスコア上位の関連キーワードの組み合わせアルゴリズム
   - 100 文字制限内での最適化
   - 重複キーワードの除去と順序最適化
   - 多言語対応（日本語・英語）

2. **P2-002: タイトル (30 文字) 生成**

   - `「{主要キーワード} - {アプリ基本名}」` テンプレートの実装
   - 30 文字制限内での最適化
   - アプリ基本名の短縮・調整機能
   - 多言語対応（日本語・英語）

3. **P2-003: このバージョンの最新情報 (4,000 文字) 生成**

   - 日本語と英語の定型文テンプレートの準備
   - リクエスト言語に応じたテンプレート切り替え
   - 主要キーワードの自然な組み込み
   - 4,000 文字制限内での最適化

#### やらないこと（Out of Scope）

- Gemini 連携とクリエイティブテキスト生成機能の実装（ステップ 3 で対応）
- API エンドポイントの統合と MVP リリース（ステップ 4 で対応）
- 外部 AI サービスとの連携（ルールベース・統計ベースのみ）
- データベースへの保存機能

#### 受入条件（Acceptance Criteria）

- 全サブタスク（P2-001〜003）が完了していること
- キーワードフィールドが 100 文字以内で生成されること
- タイトルが 30 文字以内で生成されること
- 最新情報が 4,000 文字以内で生成されること
- 日本語・英語の両方で適切に生成されること
- 主要キーワードが適切に組み込まれること
- エラーハンドリングが適切に動作すること
- 単体テストが実装され、カバレッジが 80%以上であること

#### 影響/変更ファイル

- 追加:
  - `app/services/text_generator.py` (テキスト生成サービス)
  - `app/services/keyword_field_generator.py` (キーワードフィールド生成)
  - `app/services/title_generator.py` (タイトル生成)
  - `app/services/whats_new_generator.py` (最新情報生成)
  - `app/templates/` (多言語テンプレート)
  - `tests/test_text_generator.py` (テキスト生成テスト)
- 変更:
  - `app/models/request_models.py` (テキスト生成リクエストモデルの拡張)
  - `app/models/response_models.py` (テキスト生成レスポンスモデルの拡張)
  - `app/services/csv_analyzer.py` (テキスト生成機能の統合)

#### 依存関係 / ブロッカー

- **依存**: ステップ 1（CSV 分析と主要キーワード選定エンジン）の完了
- **ブロッカー**: なし
- **後続**: ステップ 3（Gemini 連携とクリエイティブテキスト生成機能）は本ステップの完了に依存

#### 参考資料

- `docs/MVP開発ロードマップ.md` の「ステップ 2：ルールベース＆統計ベースのテキスト生成機能の実装」
- `docs/PRD.md` のテキスト生成要件
- `docs/ASO戦略ルールまとめ.md` のテキスト生成ルール

#### リスク / 留意点

- **文字数制限**: 各項目の文字数制限を厳密に守る必要
- **多言語対応**: 日本語・英語の言語特性の違いへの対応
- **キーワード最適化**: 主要キーワードの効果的な組み込み
- **テンプレート管理**: 多言語テンプレートの保守性
- **パフォーマンス**: 大量データの処理時の性能最適化

#### 見積り

- 10 時間（計画準拠）
  - P2-001: 4 時間（キーワードフィールド生成）
  - P2-002: 3 時間（タイトル生成）
  - P2-003: 3 時間（最新情報生成）
