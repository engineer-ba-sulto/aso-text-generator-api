### チケット: P3-概要 Gemini 連携とクリエイティブテキスト生成機能の実装

#### 背景 / 目的

- **背景**: ステップ 2（ルールベース＆統計ベースのテキスト生成機能）は実装済みだが、Gemini API を活用したクリエイティブなテキスト生成機能が未実装
- **目的**: Gemini API を活用し、多言語対応のプロンプト管理システムにより、サブタイトルと概要のクリエイティブなテキスト生成機能を実装する

#### スコープ（このチケットでやること）

ステップ 3 では以下の 4 つのサブタスクを順次実装します：

1. **P3-001: Gemini サービスクラスの実装**

   - Gemini API を呼び出す`gemini_generator.py`の完全実装
   - 各メソッドが`language`パラメータを受け取る設計
   - API キー管理とエラーハンドリング
   - レート制限とリトライ機能

2. **P3-002: 多言語プロンプト管理**

   - `prompts/ja.py`と`prompts/en.py`の完全実装
   - サブタイトル生成用と概要生成用のプロンプト定義
   - 言語別のプロンプト最適化
   - プロンプトテンプレートの管理システム

3. **P3-003: サブタイトル (30 文字) 生成**

   - 指定された言語のプロンプトを使用
   - 「主要キーワード」を**含めずに**アプリの価値を表現
   - 30 文字制限内での最適化
   - Gemini API との連携機能

4. **P3-004: 概要 (4,000 文字) 生成**

   - 指定された言語のプロンプトを使用
   - 「主要キーワード」を 4〜7 回程度自然に含める
   - 4,000 文字制限内での最適化
   - アプリの特徴を説明する文章生成

#### やらないこと（Out of Scope）

- API エンドポイントの統合と MVP リリース（ステップ 4 で対応）
- データベースへの保存機能
- ユーザー認証システム
- 画像生成機能

#### 受入条件（Acceptance Criteria）

- 全サブタスク（P3-001〜004）が完了していること
- Gemini API が正常に連携し、テキスト生成が動作すること
- サブタイトルが 30 文字以内で生成されること
- 概要が 4,000 文字以内で生成されること
- 日本語・英語の両方で適切に生成されること
- 主要キーワードの制約が正しく適用されること
- エラーハンドリングが適切に動作すること
- 単体テストが実装され、カバレッジが 80%以上であること

#### 影響/変更ファイル

- 追加:
  - `app/services/gemini_generator.py` (Gemini API 連携サービス)
  - `app/services/prompts/ja.py` (日本語プロンプト定義)
  - `app/services/prompts/en.py` (英語プロンプト定義)
  - `app/services/subtitle_generator.py` (サブタイトル生成サービス)
  - `app/services/description_generator.py` (概要生成サービス)
  - `tests/test_gemini_generator.py` (Gemini 連携テスト)
  - `tests/test_subtitle_generator.py` (サブタイトル生成テスト)
  - `tests/test_description_generator.py` (概要生成テスト)
- 変更:
  - `app/services/text_generator.py` (Gemini 連携機能の統合)
  - `app/models/response_models.py` (サブタイトル・概要レスポンスモデルの追加)
  - `app/config.py` (Gemini API 設定の追加)

#### 依存関係 / ブロッカー

- **依存**: ステップ 2（ルールベース＆統計ベースのテキスト生成機能）の完了
- **ブロッカー**: Google AI (Gemini) API キーの取得
- **後続**: ステップ 4（API エンドポイントの統合と MVP リリース）は本ステップの完了に依存

#### 参考資料

- `docs/MVP開発ロードマップ.md` の「ステップ 3：Gemini 連携とクリエイティブテキスト生成機能の実装」
- `docs/PRD.md` の Gemini 連携要件
- [Google Generative AI 公式ドキュメント](https://ai.google.dev/docs)
- [Gemini API リファレンス](https://ai.google.dev/api/gemini-api)

#### リスク / 留意点

- **API キー管理**: Gemini API キーのセキュアな管理
- **レート制限**: Gemini API の利用制限への対応
- **コスト管理**: API 呼び出しコストの監視
- **品質保証**: 生成テキストの品質と一貫性
- **多言語対応**: 日本語・英語の言語特性の違い
- **エラー処理**: API 障害時の適切なフォールバック

#### 見積り

- 12 時間（計画準拠）
  - P3-001: 4 時間（Gemini サービスクラス実装）
  - P3-002: 2 時間（多言語プロンプト管理）
  - P3-003: 3 時間（サブタイトル生成）
  - P3-004: 3 時間（概要生成）
